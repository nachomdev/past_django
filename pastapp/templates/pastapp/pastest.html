{% load static %} 

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Wordle Movil</title>
  <style>
    .letra-caja {
      width: 40px;
      height: 40px;
      border: 2px solid #d3d6da;
      display: inline-block;
      text-align: center;
      font-size: 24px;
      line-height: 40px;
      margin: 2px;
    }
    .letra-escribiendo {
      border-color: #565758 !important;
    }
    #teclado-invisible {
      position: absolute;
      opacity: 0;
      height: 1px;
      width: 1px;
      z-index: -1;
    }
  </style>
</head>
<body>

<div class="fila-intento" data-fila="0">
  <div class="letra-caja"></div>
  <div class="letra-caja"></div>
  <div class="letra-caja"></div>
  <div class="letra-caja"></div>
  <div class="letra-caja"></div>
</div>

<script>
  const palabraObjetivo = "PERRO";
  let filaActual = 0;

  function marcarCeldaActual() {
    document.querySelectorAll('.letra-caja.letra-escribiendo').forEach(caja => {
      caja.classList.remove('letra-escribiendo');
      caja.style.borderColor = '#d3d6da';
    });

    const filaEl = document.querySelector(`.fila-intento[data-fila="${filaActual}"]`);
    if (!filaEl) return;

    const celdas = filaEl.querySelectorAll('.letra-caja');
    let colFoco = -1;

    for (let i = 0; i < palabraObjetivo.length; i++) {
      if (celdas[i].textContent === '') {
        colFoco = i;
        break;
      }
    }

    if (colFoco === -1) {
      colFoco = palabraObjetivo.length - 1;
    }

    if (celdas[colFoco]) {
      celdas[colFoco].classList.add('letra-escribiendo');
      celdas[colFoco].style.borderColor = '#565758';

      const inputInvisible = document.getElementById('teclado-invisible');
      inputInvisible.focus();
    }
  }

  document.getElementById('teclado-invisible').addEventListener('input', function(e) {
    const letra = e.target.value.toUpperCase();
    e.target.value = '';

    const celda = document.querySelector('.letra-caja.letra-escribiendo');
    if (celda && letra.match(/^[A-Z]$/)) {
      celda.textContent = letra;
      celda.classList.remove('letra-escribiendo');
      marcarCeldaActual(); // avanzar al siguiente
    }
  });

  // Activar al tocar cualquier celda
  document.querySelectorAll('.letra-caja').forEach(celda => {
    celda.addEventListener('touchstart', () => {
      marcarCeldaActual();
    });
  });

  // Activar al cargar
  window.addEventListener('load', () => {
    marcarCeldaActual();
  });
</script>

</body>
</html>
